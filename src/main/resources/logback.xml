<?xml version="1.0" encoding="UTF-8"?>
<configuration scan="true" scanPeriod="30 seconds">
    <!-- 上下文名称：区分不同应用的日志（可选，建议设置） -->
    <contextName>my-application</contextName>

    <!-- 定义日志输出格式变量（复用格式，减少冗余） -->
    <property name="LOG_PATTERN" value="%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n" />
    <!-- 日志文件存储路径（可修改为项目实际路径，如./logs/） -->
    <property name="LOG_PATH" value="./logs" />
    <!-- 日志文件名称 -->
    <property name="LOG_FILE_NAME" value="tlias" />

    <!-- 1. 控制台输出 Appender -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <!-- 控制台输出格式 -->
        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <pattern>${LOG_PATTERN}</pattern>
            <charset>UTF-8</charset> <!-- 避免中文乱码 -->
        </encoder>
        <!-- 过滤日志级别（只输出INFO及以上级别到控制台，可选） -->
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>INFO</level>
        </filter>
    </appender>

    <!-- 2. 滚动文件输出 Appender（按时间滚动，防止单个文件过大） -->
    <appender name="ROLLING_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!-- 当前日志文件路径 -->
        <file>${LOG_PATH}/${LOG_FILE_NAME}.log</file>

        <!-- 滚动策略：按时间切割（每天一个文件） -->
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <!-- 滚动后文件的命名格式（如 app.2024-11-07.log） -->
            <fileNamePattern>${LOG_PATH}/${LOG_FILE_NAME}.%d{yyyy-MM-dd}.log</fileNamePattern>
            <!-- 日志文件保留天数（超过30天自动删除，避免磁盘占满） -->
            <maxHistory>30</maxHistory>
            <!-- 总日志大小限制（可选，如10GB，超过后删除最旧文件） -->
            <totalSizeCap>200MB</totalSizeCap>
        </rollingPolicy>

        <!-- 日志输出格式 -->
        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <pattern>${LOG_PATTERN}</pattern>
            <charset>UTF-8</charset>
        </encoder>

        <!-- 过滤日志级别（文件输出DEBUG及以上级别，方便调试） -->
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>DEBUG</level>
        </filter>
    </appender>

    <!-- 3. 错误日志单独输出 Appender（方便快速定位错误） -->
    <appender name="ERROR_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_PATH}/error.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${LOG_PATH}/error.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <pattern>${LOG_PATTERN}</pattern>
            <charset>UTF-8</charset>
        </encoder>
        <!-- 只输出ERROR级别日志 -->
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>ERROR</level>
            <onMatch>ACCEPT</onMatch> <!-- 匹配ERROR级别则输出 -->
            <onMismatch>DENY</onMismatch> <!-- 不匹配则拒绝 -->
        </filter>
    </appender>

    <!-- 4. 日志级别配置 -->
    <root level="info"> <!-- 根日志默认级别：INFO（会输出INFO、WARN、ERROR） -->
        <appender-ref ref="CONSOLE" /> <!-- 关联控制台输出 -->
        <appender-ref ref="ROLLING_FILE" /> <!-- 关联滚动文件输出 -->
        <appender-ref ref="ERROR_FILE" /> <!-- 关联错误日志输出 -->
    </root>

    <!-- 对特定包单独设置日志级别（如开发时让DAO层输出DEBUG日志） -->
<!--    <logger name="" level="DEBUG" additivity="false">-->
<!--        <appender-ref ref="ROLLING_FILE" />-->
<!--    </logger>-->

    <!-- 禁用第三方框架的冗余日志（如Spring、MyBatis，按需调整） -->
    <logger name="org.springframework" level="WARN" />
    <logger name="org.mybatis" level="WARN" />
</configuration>

<!--    private static final Logger log = LoggerFactory.getLogger(DeptController.class);-->