<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hsyuan.tliaswebstduy.mapper.EmpMapper">
<!--    更新员工信息-->
    <update id="update">
        update emp
        <set>
            <if test="username!=null and username!=''">
                username=#{username},
            </if>
            <if test="name!=null and name!=''">
                name=#{name},
            </if>
            <if test="gender!=null">
                gender=#{gender},
            </if>
            <if test="phone!=null and phone!=''">
                phone=#{phone},
            </if>
            <if test="job!=null and job!=''">
                job=#{job},
            </if>
            <if test="salary!=null">
                salary=#{salary},
            </if>
            <if test="image!=null and image!=''">
                image=#{image},
            </if>
            <if test="entryDate!=null">
                entry_date=#{entryDate},
            </if>
            <if test="deptId!=null">
                dept_id=#{deptId},
            </if>
            update_time=#{updateTime}
        </set>
        where id=#{id}
    </update>
    <update id="updatePassword">
        update emp set password=#{password} where username=#{username}
    </update>
    <!--动态sql-->
    <!--根据条件查询员工信息-->
    <select id="findByPick" resultType="com.hsyuan.tliaswebstduy.pojo.Emp">
            select emp.*,dept.name deptName from emp left join dept on emp.dept_id = dept.id
--              where true
                <where>
                    <if test="name!=null and name!=''">
                         emp.name like concat('%',#{name},'%')
                    </if>
                    <if test="gender!=null">
                        and emp.gender=#{gender}
                    </if>
                    <if test="begin!=null and end!=null">
                        and emp.entry_date between #{begin} and #{end}
                    </if>
                </where>order by emp.update_time desc
    </select>
<!--    自定义结果集-->
    <resultMap id="empResultMap" type="com.hsyuan.tliaswebstduy.pojo.Emp">
        <id property="id" column="id"/>
        <result property="username" column="username"/>
        <result property="name" column="name"/>
        <result property="gender" column="gender"/>
        <result property="phone" column="phone"/>
        <result property="job" column="job"/>
        <result property="salary" column="salary"/>
        <result property="image" column="image"/>
        <result property="entryDate" column="entry_date"/>
        <result property="deptId" column="dept_id"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="deptName" column="deptName"/>
<!--        封装exprList属性-->
                <collection property="exprList" ofType="com.hsyuan.tliaswebstduy.pojo.EmpExpr">
                    <id property="id" column="expr_id"/>
                    <result property="empId" column="expr_empid"/>
                    <result property="begin" column="expr_begin"/>
                    <result property="end" column="expr_end"/>
                    <result property="company" column="expr_company"/>
                    <result property="job" column="expr_job"/>
                </collection>
    </resultMap>
    <!--根据ID查询员工信息-->
    <select id="findEmpById" resultMap="empResultMap">
        select e.*,
               expr.id expr_id,
               expr.emp_id expr_empid,
               expr.begin as expr_begin,
               expr.end as expr_end,
               expr.company as expr_company,
               expr.job as expr_job
        from emp e left join  emp_expr expr
            on e.id = expr.emp_id
                 where e.id=#{id}
    </select>
<!--    统计每个岗位的员工数量-->
    <select id="countEmpJobData" resultType="java.util.Map">
        select (case job when 1 then '班主任'
            when 2 then '讲师'
            when 3 then '学工主管'
            when 4 then '教研主管'
            when 5 then '咨询师'
            else '其他' end) pos,
               count(*) num
        from emp
        group by pos
    </select>
    <select id="countEmpGenderData" resultType="java.util.Map">
        select count(*) value,
            if(gender=1,'男','女') name
        from emp
        group by gender
    </select>
<!--    查询所有班主任-->
    <select id="findAllJob1" resultType="com.hsyuan.tliaswebstduy.pojo.Emp">
        select * from emp where job=1
    </select>
    <select id="selectByUserNameAndPassword" resultType="com.hsyuan.tliaswebstduy.pojo.Emp">
        select id,username,name from emp where username=#{username} and password=#{password}
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        insert into emp(username,name,gender,phone,job,salary,image,entry_date,dept_id,create_time,update_time)
        values(#{username},#{name},#{gender},#{phone},#{job},#{salary},#{image},#{entryDate},#{deptId},#{createTime},#{updateTime})
    </insert>
    <!--批量删除员工-->
    <delete id="deleteBatch">
        delete from emp where id in
        <foreach collection="ids" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </delete>
</mapper>